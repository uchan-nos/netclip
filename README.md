# netclip
netclip はネットワーク越しにクリップボードにデータを送信するソフトウェアです。

# 用途
リモートに SSH でログインして作業しているとき、リモートでコピーしてローカルでペーストしたいことがよくあります。
ターミナルエミュレータ上の出力をマウスで範囲選択しコピーしてる方も多いのではないでしょうか。

もしリモート先で screen 系コマンドを使っていたりすると、マウスの選択は上手くいかないことがあります。
単語の選択ならまだしも、複数行選択だと末尾にたくさんの空白文字が残ってしまいませんか？

netclip を使うと、リモート先の任意の文字列（に限らず任意のデータ）をローカルのクリップボードに転送できます。
SSH に対応していますので、 SSH ログインが出来る環境なら使うことができます。

# 使い方
リモート側とローカル側での準備が必要です。

## リモート側の準備
netclip コマンドをインストールし、任意の場所に fifo ファイルを生成します。
リモート側は Mac OSX Mavericks で動作確認を取っていますが、
Go 言語が動く POSIX なシステムなら同じように動かせると思います。
リモート側は Windows には対応していません（fifo ファイルを作れないため）。

- コマンドのインストール  

  リモート側の OS とアーキテクチャに合ったコンパイル済みバイナリを
  https://github.com/uchan-nos/netclip/releases/ から取得し、お好みの場所に配置します。

  以下は v0.1 の場合です。最新バージョンに合わせて変更してください。

  ```
  curl -O -L https://github.com/uchan-nos/netclip/releases/download/v0.1/netclip_v0.1_darwin_amd64.zip
  unzip netclip_v0.1_darwin_amd64.zip
  ```

  もし可能なら、展開された netclip コマンドを /usr/bin など、
  SSH 環境下でも標準でパスが通るような場所にコピーしておくと楽です。
  （/usr/local/bin は SSH 環境下だとパスが通っていない場合がありますので注意が必要です。）

- fifo ファイルの生成  

  ```
  $ cd $HOME
  $ mkfifo clip
  $ chmod 600 clip
  ```
  
  clip という名前付きパイプを通して文字列をローカル側に転送します。
  書き込み権を自分だけに制限することで、他人が勝手にクリップボードに書き込みするようなイタズラができなくなります。
  
## ローカル側の準備
リモート側と同様に netclip コマンドをダウンロードして展開します。
ローカル側は Windows 7 で動作確認を取っていますが、
それ以外の Windows や Go 言語が動く POSIX なシステムでも同じように動かせると思います。

## サーバの起動
リモート側、ローカル側ともに netclip コマンドがビルドできれば、後はローカル側でサーバを立てるだけです。

```
> netclip.exe server -use-passwd 192.168.0.2:22
```

`192.168.0.2:22` はリモートホストの SSH サーバのアドレスとポートです。
ここでは、公開鍵認証の代わりにパスワード認証を使うオプション `-use-passwd` を指定してみました。
お好みの認証方式を選んでください。
（ただし、公開鍵暗号の場合はパスフレーズ付きの秘密鍵に対応してないので、
パスフレーズ無しの RSA 鍵を生成して利用してください。プルリクお待ちしております！）

ローカル側でサーバが立ち上がったら、リモート側で clip ファイルに対して書き込んでみます。

```
$ echo -n "こんにちは、世界" > ~/clip
```

コマンドを実行したら、ローカル側でテキストエディタなどを開き Ctrl+V してください。
「こんにちは、世界」が貼り付けられれば成功です。

サーバを終了したいときは、サーバを起動させたコマンドラインの画面で Ctrl-C を押下してください。

## コマンドオプション
コマンドの書式は以下です。
`host:port` の後ろに指定したオプションは無視されますのでご注意ください。

```
> netclip.exe server [options ...] host:port
```

| オプション | 初期値 | 説明 |
|------------|--------|------|
| -help | | ヘルプを表示します |
| -key <path> | `C:\Users\your-name\.ssh\id_rsa` | SSH 通信で使うための秘密鍵へのパスです |
| -use-passwd | `false` | SSH の認証で公開鍵認証の代わりにパスワード認証を使います |
| -user <name> | `your-name` | SSH の認証で使うユーザ名です。リモートにログインするためのユーザ名を指定します |
| -clip <path> | `$HOME/clip` | リモート側での clip ファイル（mkfifo で生成したファイル）へのパスです |
| -netclip <path> | `netclip` | リモート側での netclip コマンドへのパスです。 netclip コマンドにパスが通ってない場合に指定します |

`-key` や `-user` の初期値は、コマンド実行時の環境変数から自動推定するため、
上記の初期値とは異なる場合があります。
`-help` コマンドで初期値を確認してください。

### SSH 実行時の $PATH に注意
netclip コマンドにパスが通っていない場合、

```
2015/02/15 14:33:31 executing remote netclip command.
2015/02/15 14:33:31 EOF
```

のようなログが出続けます。
SSH コマンドでは環境変数がリセットされますので、
.bashrc などで設定した値は読み込まれません。

netclip コマンドを /usr/local/bin などにコピーしておいても
実はパスが通ってなかった、なんてことがよくあります。
そんなときは `-netclip` オプションでコマンドへのパスを明示してください。

### 実行例
以下にサーバの実行例をいくつか示します。

- リモート側の netclip にパスが通っていないとき

  ```
  > netclip.exe server -netclip /Users/your-name/go/src/github.com/uchan-nos/netclip/netclip 192.168.0.2:22
  ```

- 秘密鍵の場所が特殊なとき

  ```
  > netclip.exe server -key C:\path\to\identify 192.168.0.2:22
  ```

- パスワード認証で SSH 接続したいとき

  ```
  > netclip.exe server -use-passwd 192.168.0.2:22
  ```

- リモート側とローカル側のログインユーザ名が異なるとき

  ```
  > netclip.exe server -user Mr.Remote 192.168.0.2:22
  ```
